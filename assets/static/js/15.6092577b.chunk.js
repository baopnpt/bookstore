(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[15],{793:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a.n(n),l=a(16),i=a(10),s=a(11),u=a(13),c=a(12),o=a(14),p=a(0),f=a.n(p),h=a(15),m=a(72),d=a.n(m),g=a(120),v=a(740),b=a.n(v),y=a(123),k=a.n(y),E=a(24),x=a.n(E),S=a(48),C=a.n(S),O=a(232),w=a(234),I=a(78),N=a(233),j=a(761),A=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(c.a)(t).call(this,e))).state={photoIndex:0,isOpen:!1},a}return Object(o.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.photoIndex,n=t.isOpen;return f.a.createElement("div",null,f.a.createElement("img",{src:this.props.images[0],alt:"Kh\xf4ng c\xf3 h\xecnh",className:"list-item-img",onClick:function(){return e.setState({isOpen:!0})}}),n&&f.a.createElement(j.a,{mainSrc:this.props.images[a],nextSrc:this.props.images[(a+1)%this.props.images.length],prevSrc:this.props.images[(a+this.props.images.length-1)%this.props.images.length],onCloseRequest:function(){return e.setState({isOpen:!1})},onMovePrevRequest:function(){return e.setState({photoIndex:(a+e.props.images.length-1)%e.props.images.length})},onMoveNextRequest:function(){return e.setState({photoIndex:(a+1)%e.props.images.length})}}))}}]),t}(p.Component),q=a(50),P=a(238),M=a(51),F=a(762),T=a(710),D=a(170),R=a(85),J=a(84),B=a(732),H=a(725),Q=a(726),V=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).delay=1e3,a.timeout=null,a.val=null,a}return Object(o.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return f.a.createElement(T.a,{disabled:this.props.disabled,type:this.props.type,invalid:this.props.invalid||!1,placeholder:this.props.placeholder,value:this.props.value,defaultValue:this.props.defaultValue,onChange:function(t){if(e.props.onChange){e.timeout&&clearTimeout(e.timeout);e.val=t.target.value,e.timeout=setTimeout((function(){e.props.onChange({target:{value:e.val}})}),e.delay)}}})}}]),t}(p.Component),z=b()(g.a),Y=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(c.a)(t).call(this,e))).itemsPerPage=10,a.pageInfo=null,a.state={data:[],pageInfo:null,error:null,columns:[],modelSelect:{},modelSelectIds:{},currentFilter:{},tbl:null,modalQuery:{},isShowModal:!1,tblFilter:[],currentModal:null},a}return Object(o.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.init(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.init(e)}},{key:"init",value:function(){var e=Object(l.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({pageInfo:null}),a=t.pageInfo,console.log("PAGE INFO",a),a){e.next=5;break}return e.abrupt("return",h.a.alert("Kh\xf4ng t\xecm \u0111\u01b0\u1ee3c trang"));case 5:return this.pageInfo=a,Array.isArray(a.buttons)||(a.buttons=[]),Array.isArray(a.grid)||(a.grid=[]),this.setState({pageInfo:a,mode:this.props.query.mode,loading:!1}),e.next=11,this.fetchData();case 11:n=this.createColumnsData(this.pageInfo),this.setState({columns:n});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"search",value:function(){this.currentPage=1,this.setState({data:[],count:0})}},{key:"toggle",value:function(){this.setState({collapse:!this.state.collapse})}},{key:"handleFilterChange",value:function(e,t){this.setState({filter:Object(F.a)({},this.state.filter,Object(M.a)({},e,t))})}},{key:"toggleFade",value:function(){this.setState((function(e){return{fadeIn:!e}}))}},{key:"checkRequire",value:function(e){var t=!0;return this.props.pageInfo.grid.map((function(a){a.required&&!e[a.field]&&(t=!1)})),t}},{key:"fetchData",value:function(){var e=Object(l.a)(r.a.mark((function e(t){var a,n,l,i,s,u,c,o,p,f,m,d,g,v,b=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t&&this.setState({tbl:t}),!this.state.loading){e.next=4;break}return e.abrupt("return");case 4:if(this.setState({loading:!0}),a={},n=0,l=this.itemsPerPage,i=[],t&&t.filtered&&(a=this.calculateFilter(t.filtered),n=t.pageSize*t.page,l=t.pageSize),this.checkRequire(a)){e.next=9;break}return e.abrupt("return",this.setState({loading:!1,data:[]}));case 9:for(s in t&&t.sorted&&t.sorted.map((function(e){return i.push(Object(M.a)({},e.id,e.desc?"desc":"asc")),null})),0===i.length&&(i=[{id:"desc"}]),this.props.query.filter&&(a=Object.assign(a,JSON.parse(this.props.query.filter))),a);return u={queryInput:JSON.stringify(a),limit:l,skip:n},i&&(u.sort=JSON.stringify(i)),e.next=17,h.a.callPageApi(this.pageInfo,this.pageInfo.read,u);case 17:c=e.sent,o={},p={},c.data.map((function(e){return b.pageInfo.grid.map((function(t){return t.modelSelect&&(p[t.field]||(p[t.field]=[]),e[t.field]&&!x.a.includes(p[t.field],e[t.field])&&p[t.field].push(e[t.field])),null})),null})),f=[],m=[],s=0;case 23:if(!(s<this.pageInfo.grid.length)){e.next=34;break}if(this.pageInfo.grid[s].modelSelect){e.next=26;break}return e.abrupt("continue",31);case 26:if(d=this.pageInfo.grid[s],p[d.field]&&p[d.field].length>0){e.next=29;break}return e.abrupt("continue",31);case 29:m.push(d),f.push(h.a.callPageApi(this.pageInfo,d.modelSelectApi,{queryInput:JSON.stringify({id:p[d.field]})}));case 31:s++,e.next=23;break;case 34:return e.next=36,Promise.all(f);case 36:for(g=e.sent,s=0;s<m.length;s++)v=m[s],o[v.field]=g[s].data;return e.next=40,this.setState({data:c.data,modelSelect:o,count:c.count,loading:!1,nPage:Math.ceil(c.count/l),currentFilter:u});case 40:e.next=45;break;case 42:e.prev=42,e.t0=e.catch(0),console.log("err",e.t0);case 45:case"end":return e.stop()}}),e,this,[[0,42]])})));return function(t){return e.apply(this,arguments)}}()},{key:"calculateFilter",value:function(e){var t=this,a={};return e.map((function(e){for(var n=0;n<t.pageInfo.grid.length;n++){var r=t.pageInfo.grid[n];if(r.field===e.id)if(r.modelSelect)x.a.isArray&&e.value.length>0&&(a[e.id]=e.value);else switch(r.type){case"string":r.accurate?a[e.id]=e.value:a[e.id]={contains:e.value};break;case"integer":case"number":case"boolean":r.filterRange?x.a.isArray(e.value)&&(e.value[0]&&(a[e.id]||(a[e.id]={}),a[e.id][">="]=Number(e.value[0])),e.value[1]&&(a[e.id]||(a[e.id]={}),a[e.id]["<="]=Number(e.value[1]))):a[e.id]=Number(e.value);break;case"date":r.filterRange?x.a.isArray(e.value)&&(e.value[0]&&(a[e.id]||(a[e.id]={}),a[e.id][">="]=e.value[0]),e.value[1]&&(a[e.id]||(a[e.id]={}),a[e.id]["<="]=e.value[1])):e.value&&(a[e.id]={">=":C()(e.value).startOf("day").valueOf(),"<=":C()(e.value).endOf("day").valueOf()});break;default:a[e.id]={contains:e.value}}}return 0})),a}},{key:"onChange",value:function(e){this.setState({data:e})}},{key:"onButtonClick",value:function(){var e=Object(l.a)(r.a.mark((function e(t,a){var n,l,i,s,u,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.t0=t.action,e.next="api"===e.t0?4:"formModal"===e.t0?20:38;break;case 4:if(a||(a={}),!t.confirm){e.next=13;break}for(n in l=t.confirm,a)l=h.a.replaceAll(l,"#"+n+"#",a[n]);return e.next=10,h.a.confirm(l);case 10:if(e.sent){e.next=13;break}return e.abrupt("return");case 13:return this.props.query.embed&&t.embedUrl&&Object(a,JSON.stringify(this.props.query.embed)),e.next=16,h.a.callPageApi(this.pageInfo,t.api,a);case 16:return i=e.sent,h.a.alert(i.message||"Tha\u0300nh c\xf4ng"),this.fetchData(this.state.tbl),e.abrupt("break",39);case 20:for(n in s=t.modalQuery,a)s=h.a.replaceAll(s,"#"+n+"#",a[n]);(u=JSON.parse(s)).modalType||(u.modalType="form"),c=I.a,e.t1=u.modalType,e.next="preview"===e.t1?28:"voucherApprove"===e.t1?30:"sync"===e.t1?32:(e.t1,34);break;case 28:return c=I.a,e.abrupt("break",36);case 30:return c=N.a,e.abrupt("break",36);case 32:return c=P.a,e.abrupt("break",36);case 34:return c=w.a,e.abrupt("break",36);case 36:return this.setState({isShowModal:!0,modalQuery:u,currentModal:c}),e.abrupt("break",39);case 38:return e.abrupt("break",39);case 39:e.next=44;break;case 41:e.prev=41,e.t2=e.catch(0),h.a.alert(e.t2.message||"Co\u0301 l\xf4\u0303i xa\u0309y ra!");case 44:case"end":return e.stop()}}),e,this,[[0,41]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"createColumnsData",value:function(e){for(var t=this,a=[],n=function(){var n=e.grid[r],l={Header:n.name,accessor:n.field,filterable:n.filterable||!1,foldable:!0,Cell:function(e){return f.a.createElement("span",{className:"text-".concat(n.color)},e.value)}};if("date"===n.type&&(l.width=150),n.width&&(l.width=Number(n.width)),n.enumable)n.items&&n.items.length>0?(n.bindButton?l.Cell=function(a){for(var r=[],l=0;l<e.buttons.length;l++){var i=e.buttons[l];i.column===n.field&&(i.condition?("1"===i.condition&&a.value||"0"===i.condition&&!a.value)&&r.push(t.renderBtn(i,l,a)):r.push(t.renderBtn(i,l,a)))}return r}:l.Cell=function(e){for(var t=0;t<n.items.length;t++)if("boolean"===n.type){if("1"===n.items[t].value&&e.value||"0"===n.items[t].value&&!e.value)return f.a.createElement("span",{className:"text-".concat(n.color)},n.items[t].key)}else if(n.items[t].value===e.value+"")return f.a.createElement("span",{className:"text-".concat(n.color)},n.items[t].key);return null},l.Filter=function(e){var t=e.filter,a=e.onChange,r=t?t.value:"";return f.a.createElement(T.a,{value:r,type:"select",onChange:function(e){a(e.target.value)}},f.a.createElement("option",{key:-1,value:""},"T\xe2\u0301t ca\u0309"),n.items.map((function(e,t){return f.a.createElement("option",{key:t,value:e.value},e.key)})))}):l.Cell=function(e){return f.a.createElement("span",{className:"text-danger"},"CH\u01afA CO\u0301 DANH SA\u0301CH")};else if(n.modelSelect)l.Filter=function(e){var a=e.filter,r=e.onChange;return f.a.createElement(O.a.ArrayModel,{value:a?a.value:[],onChange:function(e){r(e)},schema:{modelSelectField:"id,name",pageId:t.pageInfo.id,api:n.modelSelectApi}})},t.state.modelSelect[n.field]||(l.Cell=function(e){return f.a.createElement("span",{className:"text-".concat(n.color)},e.value)}),l.Cell=function(e){if(t.state.modelSelect[n.field])for(var a=0;a<t.state.modelSelect[n.field].length;a++)if(t.state.modelSelect[n.field][a].id===e.value)return f.a.createElement("span",{className:"text-".concat(n.color)},t.state.modelSelect[n.field][a].name);return f.a.createElement("span",{className:"text-".concat(n.color)},e.value)};else switch(n.type){case"date":n.filterRange?l.Filter=function(e){var t=e.filter,a=e.onChange;return f.a.createElement(D.a,null,f.a.createElement(R.a,{md:6},f.a.createElement(O.a.Date,{value:t?t.value[0]:null,schema:{disabled:!1},onChange:function(e){var n=[];t&&t.value&&(n=t.value),n[0]=e,a(n)}})),f.a.createElement(R.a,{md:6},f.a.createElement(O.a.Date,{value:t&&t.value?t.value[1]:null,schema:{disabled:!1},onChange:function(e){var n=[];t&&t.value&&(n=t.value),n[1]=e,a(n)}})))}:l.Filter=function(e){var t=e.filter,a=e.onChange;return f.a.createElement(O.a.Date,{value:t?t.value:null,schema:{disabled:!1},onChange:function(e){a(e)}})},l.Cell=function(e){return f.a.createElement("span",{className:"text-".concat(n.color)},e.value?f.a.createElement(k.a,{format:"DD/MM/YYYY HH:mm:ss"},e.value):"")};break;case"number":n.filterRange?l.Filter=function(e){var t=e.filter,a=e.onChange;return f.a.createElement(D.a,null,f.a.createElement(R.a,{lg:6,className:"pr-1"},f.a.createElement(V,{type:"number",defaultValue:t&&t.value?t.value[0]:[],onChange:function(e){var n=[];t&&t.value&&(n=t.value),null!==e.target.value&&""!==e.target.value?n[0]=e.target.value:n[0]=null,a(n)},placeholder:"T\u1eeb"})),f.a.createElement(R.a,{lg:6,className:"pl-1"},f.a.createElement(V,{type:"number",defaultValue:t&&t.value?t.value[1]:[],onChange:function(e){var n=[];t&&t.value&&(n=t.value),null!==e.target.value&&""!==e.target.value?n[1]=e.target.value:n[1]=null,a(n)},placeholder:"\u0110\u1ebfn"})))}:l.Filter=function(e){var t=e.filter,a=e.onChange;return f.a.createElement(V,{type:"number",defaultValue:t?t.value:null,onChange:function(e){a(e.target.value)},placeholder:"T\xecm ki\u1ebfm"})},l.Cell=function(e){return f.a.createElement("span",{className:"text-".concat(n.color," full-text-right")},0===e.value?0:e.value||"")};break;case"string":"image"===n.display?l.Cell=function(e){return x.a.isArray(e.value)?f.a.createElement(A,{images:e.value,className:"list-item-img"}):f.a.createElement(A,{images:[e.value],className:"list-item-img"})}:(l.Cell=function(e){return f.a.createElement("span",{className:"text-".concat(n.color),onClick:function(){h.a.alert(JSON.stringify(e.value))}},"object"===typeof e.value?JSON.stringify(e.value):e.value)},l.Filter=function(e){var t=e.filter,a=e.onChange;return f.a.createElement(V,{type:"text",defaultValue:t?t.value:null,onChange:function(e){a(e.target.value)},placeholder:"T\xecm ki\u1ebfm"})});break;default:l.Cell=function(e){return f.a.createElement("span",{className:"text-".concat(n.color)},e.value)},l.Filter=function(e){var t=e.filter,a=e.onChange;return f.a.createElement(V,{type:"text",defaultValue:t?t.value:null,onChange:function(e){a(e.target.value)},placeholder:"T\xecm ki\u1ebfm"})}}a.push(l)},r=0;r<e.grid.length;r++)n();if(e.buttons&&e.buttons.length>0){var l=[],i=0;e.buttons.map((function(e){return"button"!==e.type||e.column?null:(i+=e.title.length,l.push(e))})),l.length>0&&a.push({Header:"T\xe1c v\u1ee5",accessor:"id",filterable:!0,width:1===l.length?10*i+50:120,fixed:"right",Cell:function(e){var a=[];return l.map((function(t,n){if(t.column)return null;if(t.hideExpression){var r=t.hideExpression;for(var l in e.original)r=h.a.replaceAll(r,l,e.original[l]);try{if(window.eval(r))return null}catch(i){}}a.push(t)})),f.a.createElement("div",null,f.a.createElement("center",null,a.map((function(a,n){return t.renderBtn(a,n,e)}))))},Filter:function(e){e.filter,e.onChange;return f.a.createElement(J.a,{block:!0,color:"danger",outline:!0,onClick:function(){t.init(t.props)}},"X\xf3a l\u1ecdc")}})}return a}},{key:"onSwitch",value:function(){var e=Object(l.a)(r.a.mark((function e(t,a,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.a.callPageApi(this.pageInfo,t.api,Object(M.a)({id:a.original.id},t.column,n));case 3:this.fetchData(this.state.tbl),e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"renderBtn",value:function(e,t,a){var n=this,r=!1;if(e.disableExpression){var l=e.disableExpression;for(var i in a.original)l=h.a.replaceAll(l,i,a.original[i]);try{window.eval(l)&&(r=!0)}catch(u){}}switch(e.type){case"switch":return f.a.createElement(O.a.Checkbox,{disabled:r,key:t,value:a.value,onChange:function(t){n.onSwitch(e,a,t)}});default:switch(e.action){case"url":var s=e.url.replace("$",a.value);for(var i in a.row)s=h.a.replaceAll(s,"#"+i+"#",a.row[i]);for(i in this.props.query)s=h.a.replaceAll(s,"@"+i+"@",this.props.query[i]);return f.a.createElement("a",{key:t,href:s,className:"btn btn-".concat(e.color," mr-1")},f.a.createElement("i",{className:e.icon})," ",e.title);case"api":case"formModal":return f.a.createElement(J.a,{disabled:r,key:t,className:"mr-1",color:e.color,onClick:function(){n.onButtonClick(e,a.original)}},f.a.createElement("i",{className:e.icon})," ",e.title);case"report":return f.a.createElement(J.a,{disabled:r,key:t,className:"mr-1",color:e.color,onClick:function(){n.onReportClick(e,"excel")}},f.a.createElement("i",{className:e.icon})," ",e.title);default:return null}}}},{key:"onReportClick",value:function(e,t){var a=h.a.getReportUrl(this.pageInfo,e.api,this.state.currentFilter);a+="&type=".concat(t),window.open(window.host+a,"_blank")}},{key:"render",value:function(){var e=this;return this.state.error?f.a.createElement("p",{className:"text-danger"},this.state.error):this.state.pageInfo?f.a.createElement(D.a,null,f.a.createElement(R.a,{md:"12"},f.a.createElement(B.a,{isOpen:this.state.isShowModal,fade:!1,size:"lg",backdrop:!0,toggle:function(){e.fetchData(e.state.tbl),e.setState({isShowModal:!1})}},f.a.createElement(H.a,{toggle:function(){e.fetchData(e.state.tbl),e.setState({isShowModal:!1})}}," ",this.props.query.name?this.props.query.name:this.pageInfo.name),f.a.createElement(Q.a,null,this.state.currentModal&&this.state.isShowModal?f.a.createElement(this.state.currentModal,{query:this.state.modalQuery,onClose:function(){e.fetchData(e.state.tbl),e.setState({isShowModal:!1})}}):f.a.createElement(q.a,null)))),f.a.createElement(R.a,{md:12},f.a.createElement("div",{className:"pull-left"},f.a.createElement("h3",{className:"mb-2"},this.props.query.name?this.props.query.name:this.pageInfo.name),f.a.createElement("p",{className:"small text-muted mb-2"}," (",this.state.count," b\u1ea3n ghi)")),f.a.createElement("div",{className:"pull-right"},this.pageInfo.buttons.map((function(t,a){return"submit"!==t.type?null:e.renderBtn(t,a,{})})))),f.a.createElement(R.a,{md:12},f.a.createElement(z,{ref:"table",previousText:"Trang tr\u01b0\u1edbc",nextText:"Trang sau",pageText:"Trang",rowsText:"b\u1ea3n ghi",ofText:"tr\xean t\u1ed5ng s\u1ed1",data:this.state.data,loading:this.state.loading,manual:!0,showPageJump:!0,onFetchData:this.fetchData.bind(this),pages:this.state.nPage,columns:this.state.columns,defaultPageSize:this.itemsPerPage,className:"-striped -highlight data-table",loadingText:"\u0110ang t\u1ea3i d\u1eef li\u1ec7u..."}))):f.a.createElement(q.a,null)}}]),t}(p.Component),K=(b()(g.a),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(c.a)(t).call(this,e))).itemsPerPage=10,a.pageInfo=null,a.query=d.a.parse(e.location.search,{ignoreQueryPrefix:!0}),a.state={data:[],pageInfo:null,error:null,columns:[],modelSelect:{},modelSelectIds:{},currentFilter:{},tbl:null,modalQuery:{},isShowModal:!1,tblFilter:[],currentModal:null},a}return Object(o.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.init(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.init(e)}},{key:"init",value:function(){var e=Object(l.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({pageInfo:null}),this.query=d.a.parse(t.location.search,{ignoreQueryPrefix:!0}),e.next=4,h.a.getPage(this.query.page);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",h.a.alert("Kh\xf4ng t\xecm \u0111\u01b0\u1ee3c trang"));case 7:this.pageInfo=a,Array.isArray(a.buttons)||(a.buttons=[]),Array.isArray(a.grid)||(a.grid=[]),this.setState({query:this.query,pageInfo:a,mode:this.query.mode,loading:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.query&&this.state.pageInfo?f.a.createElement(Y,{query:this.state.query,pageInfo:this.state.pageInfo}):f.a.createElement(q.a,null)}}]),t}(p.Component));t.default=K}}]);